pipeline {
    agent {
        label 'windows'
    }
    
    stages {
        stage('Initialisation') {
            steps {
                bat '''
                    @echo off
                    echo ===========================
                    echo JENKINS WINDOWS BUILD
                    echo ===========================
                    echo Date: %date%
                    echo Time: %time%
                    echo Build: %BUILD_NUMBER%
                    echo ===========================
                    echo.
                '''
            }
        }
        
        stage('Vérification fichiers') {
            steps {
                bat '''
                    echo Liste des fichiers...
                    echo ---------------------
                    dir
                    echo.
                    
                    echo Fichiers HTML...
                    echo -----------------
                    dir *.html
                    echo.
                    
                    echo Fichiers CSS...
                    echo ----------------
                    dir *.css
                    echo.
                '''
            }
        }
        
        stage('Test rapide') {
            steps {
                bat '''
                    echo Test des fichiers...
                    echo --------------------
                    
                    if exist index.html (
                        echo ✓ index.html présent
                    ) else (
                        echo ❌ index.html manquant
                        exit 1
                    )
                    
                    echo.
                    echo Test de base terminé
                '''
            }
        }
        
        stage('Créer archive') {
            steps {
                bat '''
                    echo Création de l'archive...
                    
                    mkdir package
                    copy *.html package\
                    copy *.css package\
                    
                    echo Version: %BUILD_NUMBER% > package\version.txt
                    echo Date: %date% >> package\version.txt
                    
                    powershell -Command "Compress-Archive -Path 'package\\*' -DestinationPath 'site-build-%BUILD_NUMBER%.zip'"
                    
                    echo ✓ Archive créée: site-build-%BUILD_NUMBER%.zip
                '''
                
                archiveArtifacts artifacts: 'site-build-*.zip'
            }
        }
        
        stage('Fin') {
            steps {
                bat '''
                    echo.
                    echo ===========================
                    echo BUILD TERMINE
                    echo ===========================
                    echo.
                '''
            }
        }
    }
    
    post {
        always {
            bat '''
                echo Nettoyage...
                if exist package rmdir /S /Q package
            '''
        }
    }
}